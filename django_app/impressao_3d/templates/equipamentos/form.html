{% extends 'base.html' %}

{% block content %}
<h1>{% if equipamento %}Editar{% else %}Novo{% endif %} Equipamento</h1>

<form method="POST" id="equipamento-form" style="max-width:600px; margin:auto;">
    {% csrf_token %}
    {{ form.as_p }}

    <button type="submit" class="btn">Salvar</button>
</form>

<a href="{% url 'equipamentos:lista' %}" style="display:block; margin-top:20px;">‚Üê Voltar</a>

<script>
document.getElementById('adicionar-fabricante-toggle').addEventListener('click', function(e){
    e.preventDefault();
    var div = document.getElementById('novo-fabricante-div');
    div.style.display = div.style.display === 'none' ? 'block' : 'none';
});

document.getElementById('adicionar-fabricante-btn').addEventListener('click', function(){
    var nome = document.getElementById('novo-fabricante').value.trim();
    if(!nome) return;

    fetch("{% url 'equipamentos:adicionar_fabricante_ajax' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
        },
        body: JSON.stringify({nome: nome})
    })
    .then(res => res.json())
    .then(data => {
        var select = document.getElementById('fabricante');
        var option = document.createElement('option');
        option.value = data.id;
        option.text = data.nome;
        option.selected = true;
        select.add(option);
        document.getElementById('novo-fabricante-div').style.display = 'none';
        document.getElementById('novo-fabricante').value = '';
    })
    .catch(err => console.error(err));
});
</script>
{% endblock %}
`
